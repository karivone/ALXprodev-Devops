#!/bin/bash

# List of Pokémon
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# API Base URL
BASE_URL="https://pokeapi.co/api/v2/pokemon"

# Error log
ERROR_LOG="errors.txt"
> "$ERROR_LOG"

# Function to fetch data for one Pokémon
fetch_pokemon() {
  local name="$1"
  local output_file="${name}.json"
  local retries=0
  local success=0

  while [ $retries -lt 3 ]; do
    status_code=$(curl -s -w "%{http_code}" -o "$output_file" "$BASE_URL/$name")
    if [ "$status_code" -eq 200 ]; then
      echo "Fetched $name"
      success=1
      break
    else
      echo "Retry $((retries+1)) for $name failed (status: $status_code)"
      retries=$((retries + 1))
      sleep 2
    fi
  done

  if [ $success -eq 0 ]; then
    echo "[$(date)] Failed to fetch $name after 3 attempts. Status: $status_code" >> "$ERROR_LOG"
    rm -f "$output_file"
  fi
}

# Loop over all Pokémon and run fetch in background
for name in "${POKEMON_LIST[@]}"; do
  fetch_pokemon "$name" &
done

# Wait for all background jobs to finish
wait

echo "✅ All Pokémon fetch tasks completed."
